<!DOCTYPE html>
<html>
    <head>
        <title>Create Questionnaire</title>
        <link rel="stylesheet" type="text/css" href="../css/create.css">
        <link rel="stylesheet" type="text/css" href="../css/common.css">
        <link rel="stylesheet" type="text/css" href="../css/animations.css">
        <link rel="stylesheet" type="text/css" href="../css/nav.css">
        <link rel="shortcut icon" type="image/png" href="../images/bluepear.png"/>
    
        <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
        <meta content="utf-8" http-equiv="encoding">

        <script type="text/javascript" src="../scripts/jszip.js"></script>
        <script type="text/javascript" src="../scripts/FileSaver.js"></script>
        <script type="text/javascript" src="../scripts/myexcel.js"></script>
        <script type="text/javascript" src="../scripts/jquery-3.4.1.js"></script>
        <script type="text/javascript" src="../scripts/event_handler.js"></script>
        <script type="text/javascript" src="../scripts/manager.js"></script>
    </head>
    <body>
        <nav>
            <a href="manager.html">
                <image id="logo" src="../images/nokia-logo.png"/>
                <h2 id="sublogo">BluePear</h2><br/>
            </a>
        </nav>
        <div id="content">
            <h1 class="headline">Create Questionnaire</h1>
            <div class="wrapper">
            <div id="titlebar">
                <input id="cardTitle" class="questionnaire" type="text" placeholder="Questionnaire File Name">
            </div>
                <div id="form">
                    <br/>
                    <h3>Questions</h3>
                    <div id="categoriesContainer">
                        <div class="set">
                            <span class="categoryContainer">
                                <label class="expandable expanded"></label>
                                <input id="category" class="category" name="category1" type="text" placeholder="Type to add a category">
                                <label id="delete_category" class="delete"><img src="../images/delete-hover.png"/></label>
                            </span>
                            <span class="questionContainer">
                                <div class="list_questions">
                                    <ol class="itemList" id="category1">
                                        <li>
                                            <span class="item">
                                                <input class="category1" id="question" type="text" placeholder="Type to add a question">
                                                <label id="delete1" class="delete"><img src="../images/delete-hover.png"/></label>
                                            </span>
                                        </li>
                                    </ol>
                                </div>
                            </span>
                        </div>
                    </div>
                    
                    <div id="participantsContainer">
                        <br/>
                        <h3>Participants</h3>
                        <div class="set">
                            <span class="categoryContainer">
                                <label class="expandable expanded"></label>
                                <input id="team" class="team" name="team1" type="text" placeholder="Type to add a team">
                                <label id="delete_team" class="delete"><img src="../images/delete-hover.png"/></label>
                            </span>
                            <span class="questionContainer">
                                <div class="list_participants">
                                    <ol class="itemList" id="team1">
                                        <li>
                                            <span class="item">
                                                <input class="team1 member" id="participant" type="text" placeholder="Type to add a member">
                                                <label id="delete_btn" class="delete"><img src="../images/delete-hover.png"/></label>
                                            </span>
                                        </li>
                                    </ol>
                                </div>
                            </span>
                        </div>
                    </div>
                    <input type="submit" value="Submit" onclick="check()">
                </div>
            </div>
        </div>
        <script>
            $(window).on('load', function(){
                $(document).on('click', '.expandable', function(){
                    if(this.classList.contains("expanded")){
                        this.parentElement.nextElementSibling.style.display = "none";
                        this.classList.add("collapsed");
                        this.classList.remove("expanded");
                    } else if(this.classList.contains("collapsed")){
                        this.parentElement.nextElementSibling.style.display = "block";
                        this.classList.add("expanded");
                        this.classList.remove("collapsed");
                    }
                });
            });
            
            function check(){
                var inputs = document.querySelectorAll("input");
                var isEmpty = true;
                for(var x = 0; x < inputs.length-1; x++){
                    if(inputs[x].value != ""){
                        isEmpty = false;
                    }
                }
                
                if(isEmpty == true){
                    alert("Please input necessary data");
                } else{
                    var members = document.getElementsByClassName("member");
                    var array = [];
                    var lastIndex = members.length-1;
                    alert("last number of x = " + lastIndex);
                    for(var x = 0; x < members.length; x++){
                        if(members[x].value != "" || x == lastIndex){
                            alert(members[x].value);
                            alert("x = " + x);
                            $.post("../php/connect.php",
                                {
                                    job: "check_members",
                                    username: members[x].value
                                },
                                function(data, status){
                                    alert("post x = " + x);
                                    if(x == lastIndex){
                                        alert("last index, array length = " + array.length);
                                        if(array.length != 0){
                                            alert("Some members do not exist");
                                            for(var y = 0; y < array.length; y++){
                                                members[array[y]].borderBottomColor = "#FF0000";
                                            }
                                        }else{
                                            create_questions();
                                        }
                                    }else{
                                        alert(data);
                                        if(data == "false"){
                                            array.push(x);
                                            alert("Pushed" + array.length);
                                        } else{
                                            members[x].borderBottomColor = "#d0d0d0";
                                        }
                                    }
                                }
                            );
                        }
                    }
                }
            }
        </script>
    </body>
</html>